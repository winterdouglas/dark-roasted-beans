#!/usr/bin/env node
/**
 * Do all things that need to be done after installing packages (with yarn, npm, pnpm).
 * This script was taken from Ignite and tweaked for this project needs.
 *
 * Yes, it slows down package installation a little, but it's nice to not
 * have to remember these extra steps.
 */

// Applies patches, if any
// REMARK: This is done automatically when using yarn patch, therefore there's no need to use patch-package
// run("npx patch-package")

// Kill the metro bundler if it's running.
if (["darwin", "linux"].includes(process.platform)) {
  run('pkill -f "cli.js start" || set exit 0');
}

/**
 * On darwin machine:
 *   1. Check if CocoaPods CLI is installed (and if not, install it)
 *   2. Find an Xcode project dir
 *   3. Run `pod install`, if fails run `pod repo update` and try again
 */
run("npx pod-install");

function run(command) {
  console.log(`./bin/postinstall script running: ${command}`);

  try {
    require("child_process").execSync(command, { stdio: "inherit" });
  } catch (error) {
    console.error(`./bin/postinstall failed on command:\n  ${command}`);
    process.exit(error.status);
  }
}
